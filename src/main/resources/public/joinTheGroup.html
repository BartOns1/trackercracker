<!DOCTYPE html>

<html lang="en">
<head>
    <title>Join Your Group</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous"/>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>

    <meta charset="UTF-8"/>
</head>
<body>
<h1 class="jumbotron">Participate</h1>

<div class="container">
    <table class="table table-striped">
        <thead>
        <tr>
            <th>track Label</th>
            <th>color</th>
            <th>Delete Yourself</th>
        </tr>
        </thead>
        <tbody id="passenger-list-data">
        <tr>
            <td>X</td>
            <td>X</td>
            <td></td>
        </tr>
        </tbody>
    </table>

    <form id="participant-create-form">
        <div class="form-group">
            <label for="group">Please enter The name of your track group you want to join:</label>
            <input class="form-control" id="group" name="group"/>
        </div>
        <div class="form-group">
            <label for="label">Enter a track name to label your track:</label>
            <input class="form-control" id="label" name="label"/>
        </div>

        <input type="submit" class="btn btn-primary" value="Create">
    </form>
</div>

<script>
            $("#participant-create-form").submit(function(e) {
                e.preventDefault();


               let g = $.ajax({
                    method: 'get',
                    url: '/api/group/' + $('#group').val(),
                    dataType:'json',
                    async: false
                    }).responseJSON;


                let p = {
                    label: $('#label').val(),
                    group: g
                };


                console.log(p, g);

                $.ajax({
                    method: 'post',
                    url: '/api/group/participant',
                    contentType: 'application/json',
                    data: JSON.stringify(p), // Better way to do this?
                    processData: false,
                    success: function() {
                        // Refresh data table
                        loadParticipants();

                    }
                });


                this.reset();
            });

            loadParticipants();

            function loadParticipants() {
                let groupName = "FightBataljon";
                $.getJSON(`/api/group/participants/${groupName}`, function (participants) {
                    let $tbody = $("#participant-list-data").empty();

                    for (let participant of participants) {
                        let $removeButton = $("<button>").addClass("btn").addClass("btn-danger").text("Remove");
                        $removeButton.click(function(e) {
                            $.ajax({
                                method: 'delete',
                                url: `/api/passenger/${passenger.id}`,
                                success: loadParticipants()
                            });
                        });

                        let $row = $('<tr>')
                            .append($('<td>').text(participant.label))
                            .append($('<td>').text(participant.traceRecord))
                            .append($('<td>').append($removeButton));
                        $tbody.append($row);
                    }
                });
            }
        </script>

</body>
</html>